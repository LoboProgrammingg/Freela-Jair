{% extends "base.html" %}
{% load l10n %}

{% block page_title %}Funcionários{% endblock %}
{% block header_title %}Gestão de Funcionários{% endblock %}

{% block content %}

<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
    <div class="bg-white p-6 rounded-xl shadow flex items-center space-x-4">
        <div class="bg-blue-100 p-3 rounded-full">
            <svg class="w-6 h-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m-7.5-2.952a4.5 4.5 0 011.88-3.762A4.5 4.5 0 0118 15.75v-1.5a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5A3.375 3.375 0 006.375 7.5H5.25m9.75 4.5H5.25z" /></svg>
        </div>
        <div>
            <h3 class="text-sm font-medium text-gray-500">Total de Funcionários (Exibidos)</h3>
            <p class="mt-1 text-3xl font-semibold text-gray-900">{{ total_funcionarios }}</p>
        </div>
    </div>
    <div class="bg-white p-6 rounded-xl shadow flex items-center space-x-4">
        <div class="bg-green-100 p-3 rounded-full">
            <svg class="w-6 h-6 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
        </div>
        <div>
            <h3 class="text-sm font-medium text-gray-500">Custo Mensal (Exibidos)</h3>
            <p class="mt-1 text-3xl font-semibold text-gray-900">R$ {{ custo_mensal_total|localize }}</p>
        </div>
    </div>
</div>

<div class="bg-white shadow-lg rounded-xl overflow-hidden">
    <div class="px-6 py-4 flex flex-col sm:flex-row justify-between items-center gap-4 border-b border-gray-200 bg-gray-50/50">
        <form method="GET" class="flex items-center gap-2">
            <label for="status" class="text-sm font-medium text-gray-700">Filtrar por:</label>
            <select name="status" id="status" onchange="this.form.submit()" class="rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 text-sm">
                <option value="todos" {% if status_ativo == 'todos' %}selected{% endif %}>Todos</option>
                <option value="pago" {% if status_ativo == 'pago' %}selected{% endif %}>Pagos</option>
                <option value="pendente" {% if status_ativo == 'pendente' %}selected{% endif %}>Pendentes</option>
            </select>
        </form>
        <div class="flex items-center gap-2">
            <a href="{% url 'historico-pagamentos' %}" class="px-4 py-2 bg-white border border-gray-300 text-gray-800 text-sm font-medium rounded-md hover:bg-gray-50 transition-colors">
                Ver Histórico
            </a>
            <a href="{% url 'funcionario-create' %}" class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 transition-colors shadow-sm">
                Adicionar Funcionário
            </a>
        </div>
    </div>

    <div class="overflow-x-auto">
        <table class="min-w-full">
            <thead class="bg-gray-50">
                <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Funcionário</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Salário Mensal</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for funcionario in funcionarios %}
                <tr class="hover:bg-gray-50 transition-colors">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-10 w-10 flex items-center justify-center bg-gray-200 rounded-full">
                                <svg class="w-6 h-6 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.5a5.5 5.5 0 0 1 3.096 10.047 9.005 9.005 0 0 1 5.9 8.181.75.75 0 1 1-1.496.07 7.502 7.502 0 0 0-14.992 0 .75.75 0 1 1-1.496-.07 9.005 9.005 0 0 1 5.9-8.181A5.5 5.5 0 0 1 12 2.5ZM8 8a4 4 0 1 0 8 0 4 4 0 0 0-8 0Z" /></svg>
                            </div>
                            <div class="ml-4">
                                <div class="text-sm font-medium text-gray-900">{{ funcionario.nome }}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">R$ {{ funcionario.salario|localize }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        {% if funcionario.pagamento_efetuado %}
                            <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                ✔ Pago em {{ funcionario.data_pagamento|date:"d/m/y" }}
                            </span>
                        {% else %}
                            <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                                ✖ Pendente
                            </span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex items-center space-x-4">
                            {% if not funcionario.pagamento_efetuado %}
                                <form action="{% url 'confirmar-pagamento' funcionario.pk %}" method="POST" class="inline">
                                    {% csrf_token %}
                                    <button type="submit" class="px-3 py-1 text-xs font-medium text-white bg-green-600 rounded-md hover:bg-green-700">
                                        Confirmar Pag.
                                    </button>
                                </form>
                            {% endif %}
                            <a href="{% url 'funcionario-update' funcionario.pk %}" class="text-indigo-600 hover:text-indigo-900">Editar</a>
                            <a href="{% url 'funcionario-delete' funcionario.pk %}" class="text-red-600 hover:text-red-900">Excluir</a>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center py-16">
                         </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endblock %}